<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <!-- Add your CSS and JS links here -->
    <link rel="stylesheet" href="/static/css/chat.css"> <!-- Add your CSS file path -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <section class="msger">
        <header class="msger-header">
            <div class="msger-header-title">
                <i class="fas fa-robot"></i> Chatbot <i class="fas fa-robot"></i>
            </div>
        </header>

        <main class="msger-chat" id="messages">
            <!-- User and bot messages will be dynamically inserted here -->
        </main>

        <form class="msger-inputarea" method="POST" action="/chat" id="chatForm">
            <input type="text" class="msger-input" id="textInput" name="message" placeholder="Enter your message...">
            <button type="button" class="msger-send-btn" id="sendButton">Send</button>
        </form>
    </section>

    <script>
        $(document).ready(function () {
            const BOT_IMG = "/static/imgs/chatbot.png"; // Change to your bot image URL
            const PERSON_IMG = "/static/imgs/user.png"; // Change to your user image URL
            const BOT_NAME = "Chatbot";
            const PERSON_NAME = "You";

            const msgerChat = document.querySelector(".msger-chat");

            let lastUserMessage = "";

            // Function to append messages
            function appendMessage(side, name, text) {
                const imgSrc = side === "left" ? PERSON_IMG : BOT_IMG;
                const time = getCurrentTime();

                const messageHTML = `
                    <div class="msg ${side}-msg">
                        <div class="msg-img" style="background-image: url(${imgSrc})"></div>
                        <div class="msg-bubble">
                            <div class="msg-info">
                                <div class="msg-info-name">${name}</div>
                                <div class="msg-info-time">${time}</div>
                            </div>
                            <div class="msg-text">${text}</div>
                        </div>
                    </div>
                `;

                msgerChat.insertAdjacentHTML("beforeend", messageHTML);

                // Scroll to the bottom of the chat
                msgerChat.scrollTop = msgerChat.scrollHeight;
            }

            // Function to get the current time
            function getCurrentTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                return hours + ":" + minutes;
            }

            // Add event listener to handle sending message
            $("#sendButton").click(sendMessage);

            // Add event listener to handle Enter key press
            $("#textInput").on("keyup", function (event) {
                if (event.keyCode === 13) {
                    sendMessage();
                }
            });

            function sendMessage() {
                var userMessage = $("#textInput").val();
                lastUserMessage = userMessage;
                $("#textInput").val("");

                // Append user message to the chat interface
                appendMessage("left", PERSON_NAME, userMessage);

                // Send user message to the server
                $.post("/chat", { message: userMessage }, function (data) {
                    var botResponse = data.bot_response;

                    // Append bot response to the chat interface
                    appendMessage("right", BOT_NAME, botResponse);
                });
            }
        });
    </script>
</body>
</html>